# Personalized Feed Recommendation Service (FastAPI + CatBoost)

Ётот проект Ч одна из частей финального проекта на курсе "»нженер машинного обучени€" от Karpov.Courses. ¬ нем реализован сервис персональных рекомендаци€ постов дл€ пользователей.

## ‘ункционал проекта

ѕроект включает:

- вычисление пользовательских и постовых фичей (feature engineering)
- загрузку фичей в базу данных PostgreSQL
- обучение модели CatBoost дл€ ранжировани€ постов
- разработку FastAPI сервиса дл€ выдачи рекомендаций
- эндпоинт, который возвращает **топ-5 постов** дл€ каждого пользовател€

---

## ћодель

»спользуетс€ **CatBoostClassifier**, обученный на:

- поведенческих фичах пользователей
- статистике взаимодействий с постами
- текстовых фичах (длина текста, текстова€ разнообразность)
- OHE-кодировании тем (`topic`)
- CTR постов по последнему 1M просмотров
- CTR пользователей
- User-topic CTR по каждой теме

»тогова€ метрика HitRate@5 ? **0.55+** после улучшений (в ноутбуке значение метрики около 0.45, но LMS курса тестировала 2000 запросах, получилось значение метрики 0.602)

ћодель сохранена в файл: `catboost_model.cbm`

---

##  —труктура базы данных

»спользуютс€ две таблицы:

1. **user_features**  
   `arsenij_shmelev_gwh6987_features_lesson_22`  
   (фичи пользователей)

2. **post_text_df**  
   (исходные тексты постов)

ƒл€ получени€ CTR постов дополнительно загружаетс€ часть таблицы 'feed_data'

##  ак работает сервис

### Ёндпоинт: GET /post/recommendations/

### ѕараметры:

| ѕараметр | “ип        | ќписание                           |
|---------|------------|-------------------------------------|
| id      | int        | user_id дл€ рекомендаций            |
| time    | datetime   | текущее врем€                       |
| limit   | int        | количество возвращаемых постов (5)  |

### ѕример запроса

```python
import requests
from datetime import datetime

params = {
    "id": 203,
    "time": datetime(2020, 5, 17),
    "limit": 5
}

resp = requests.get("http://127.0.0.1:8000/post/recommendations/", params=params)
print(resp.json())
```

### ѕример ответа
```json
[
  {
    "id": 12345,
    "text": "Some post text...",
    "topic": "sport"
  },
  ...
]
```

## ќсновные файлы
1. app.py - код FastAPI сервиса
2. processing.ipynb - полна€ обработка данных и обучение модели
3. catboost_model.cbm - обученна€ модель
4. model_download.py - вспомогательна€ функци€ загрузки модели (нужна дл€ проверки в LMS курса)